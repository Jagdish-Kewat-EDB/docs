---
title: "Securing your cluster"
---

Azure Security Center helps assess and enforce BigAnimal's security requirements across the resources used to deploy your clusters.  


# Configure the default Azure Security Center (ASC) policy

Before deploying your clusters, EDB recommends that you perform the following steps in each of your Azure subscriptions:

## Configure the default Azure Security Center (ASC) policy 

Define the parameters in your default ASC policy to ensure that your resources are compliant with BigAnimal's security requirements.  

#### Allowed container ports list 
BigAnimal runs containers using these ports: 
 * 5432
 * 9187
 * 8000
 * 9000
 * 9443
 * 9402
 * 10250
 * 9090
 * 8080
 * 8443
 * 2020
 * 3000
 * 6443
 * 9100
 * 9102
 * 9201
 * 8081

#### Recommended Allowed service ports list 

BigAnimal runs containers using these services ports:
 * 5432
 * 9402
 * 443
 * 8080
 * 9090
 * 3000
 * 8443
 * 9443
 * 9100
 * 9201


#### Recommended Allowed AppArmor profiles

BigAnimal uses AppArmor's default profile: 
 * runtime/default

#### Recommended Allowed capabilities 

BigAnimal runs containers with minimum security capabilities only required to implement data plane functionality such as logging functionality.

 * FOWNER 

#### Recommended Max allowed memory bytes in Kubernetes cluster

BigAnimal runs containers with a maximum allowed memory bytes of 6Gi.

#### Recommended Max allowed CPU units in Kubernetes cluster

BigAnimal runs containers with a maximum of two allowed CPU units 2. 

#### Recommended Allowed host paths 

BigAnimal uses the following hotpaths in its containers:

```
{
 "paths": [
   {
     "pathPrefix": "/var/log",
     "readOnly": false
   },
   {
     "pathPrefix": "/var/lib/docker/containers",
     "readOnly": true
   },
   {
     "pathPrefix": "/",
     "readOnly": true
   },
   {
     "pathPrefix": "/sys",
     "readOnly": true
   },
   {
     "pathPrefix": "/proc",
     "readOnly": true
   },
   {
     "pathPrefix": "/var/run/docker.sock",
     "readOnly": false
   },
   {
     "pathPrefix": "/run/containerd/containerd.sock",
     "readOnly": false
   },
   {
     "pathPrefix": "/dev",
     "readOnly": false
   },
   {
     "pathPrefix": "/boot",
     "readOnly": true
   },
   {
     "pathPrefix": "/lib/modules",
     "readOnly": false
   },
   {
     "pathPrefix": "/usr",
     "readOnly": true
   },
   {
     "pathPrefix": "/etc",
     "readOnly": true
   }
 ]
}
```
#### To configure the ASC policy parameters

1. Launch the Azure Policy service in the Azure portal by searching for and selecting the *Policy* service in the search box at the top.

1. Select **Assignments** on the left side of the Azure Policy page. 

1. Select **Assign Policy** from the top of the Policy - Assignments page.

1. On the Assign Policy page, set the Scope by selecting the ellipsis and then selecting the applicable subscription. A scope determines what resources or grouping of resources the policy assignment gets enforced on. Then use the **Select** button at the bottom of the Scope page.

1. Select the Policy definition ellipsis to open the list of available definitions. Azure Policy comes with built-in policy definitions you can use. Many are available, such as:
 - Enforce tag and its value
 - Apply tag and its value
 - Inherit a tag from the resource group if missing
 - For a partial list of available built-in policies, see Azure Policy samples.

1. Search through the policy definitions list to find the ASC policy policy definition you need. Select that policy and then use the Select button.

1. The Assignment name is automatically populated with the policy name you selected, but you can change it. For this example. You can also add an optional Description. The description provides details about this policy assignment. Assigned by will automatically fill based on who is logged in. This field is optional, so custom values can be entered.

1. Leave policy enforcement Enabled. For more information, see Policy assignment - enforcement mode.

1. Select Next at the bottom of the page or the Parameters tab at the top of the page to move to the next segment of the assignment wizard.

1. If the policy definition selected on the Basics tab included parameters, they are configured on this tab. Since the Audit VMs that do not use managed disks has no parameters, select Next at the bottom of the page or the Remediation tab at the top of the page to move to the next segment of the assignment wizard.

1. Leave Create a Managed Identity unchecked. This box must be checked when the policy or initiative includes a policy with either the deployIfNotExists or modify effect. As the policy used for this quickstart doesn't, leave it blank. For more information, see managed identities and how remediation security works.

1. Select Next at the bottom of the page or the Non-compliance messages tab at the top of the page to move to the next segment of the assignment wizard.

1. Set the Non-compliance message to Virtual machines should use a managed disk. This custom message is displayed when a resource is denied or for non-compliant resources during regular evaluation.

1. Select Next at the bottom of the page or the Review + Create tab at the top of the page to move to the next segment of the assignment wizard.

1. Review the selected options, then select Create at the bottom of the page.

## Remediate non-compliant resources

You're now ready to identify non-compliant resources to understand the compliance state of the resources in your subscription.

Select Compliance in the left side of the page. If there are any existing resources that aren't compliant with this new assignment, they appear under Non-compliant resources.

When a condition is evaluated against your existing resources and found true, then those resources are marked as non-compliant with the policy. The following table shows how different policy effects work with the condition evaluation for the resulting compliance state. Although you don't see the evaluation logic in the Azure portal, the compliance state results are shown. The compliance state result is either compliant or non-compliant.


# Security scores and alerts

This section provides information to help you understand and improve your current security using secure scores and alerts.